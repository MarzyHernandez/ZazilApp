<!doctype html>
<html lang="en">

  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Meta -->
    <meta name="description" content="Responsive Bootstrap Admin Dashboards">
    <meta name="author" content="Bootstrap Gallery" />
    <link rel="canonical" href="https://www.bootstrap.gallery/">
    <meta property="og:url" content="https://www.bootstrap.gallery">
    <meta property="og:title" content="Admin Templates - Dashboard Templates | Bootstrap Gallery">
    <meta property="og:description" content="Marketplace for Bootstrap Admin Dashboards">
    <meta property="og:type" content="Website">
    <meta property="og:site_name" content="Bootstrap Gallery">
    <link rel="shortcut icon" href="assets/images/logo_zazil.png">

    <!-- Title -->
    <title>Zazil Añadir Producto</title>

    <!-- *************
			************ Common Css Files *************
		************ -->

    <!-- Animated css -->
    <link rel="stylesheet" href="assets/css/animate.css">

    <!-- Bootstrap font icons css -->
    <link rel="stylesheet" href="assets/fonts/bootstrap/bootstrap-icons.css">

    <!-- Main css -->
    <link rel="stylesheet" href="assets/css/main.min.css">


    <!-- *************
			************ Vendor Css Files *************
		************ -->

    <!-- Scrollbar CSS -->
    <link rel="stylesheet" href="assets/vendor/overlay-scroll/OverlayScrollbars.min.css">

    <!-- Uploader CSS -->
    <link rel="stylesheet" href="assets/vendor/dropzone/dropzone.min.css" />

  </head>

  <body>

    <!-- Loading wrapper start -->
    <!-- <div id="loading-wrapper">
			<div class="spinner">
                <div class="line1"></div>
				<div class="line2"></div>
				<div class="line3"></div>
				<div class="line4"></div>
				<div class="line5"></div>
				<div class="line6"></div>
            </div>
		</div> -->
    <!-- Loading wrapper end -->

    <!-- Page wrapper start -->
    <div class="page-wrapper">

      <!-- Sidebar wrapper start -->
      <nav class="sidebar-wrapper">

        <!-- Sidebar brand starts -->
        <div class="sidebar-brand">
          <a href="index.html" class="logo">
            <img src="assets/images/logo_zazil.png"/>
          </a>
        </div>
        <!-- Sidebar brand starts -->

        <!-- Sidebar menu starts -->
        <div class="sidebar-menu">
          <div class="sidebarMenuScroll">
            <ul>
            <li class="sidebar">
                <a href="index.html">
                  <i class="bi bi-house"></i>
                  <span class="menu-text">Dashboard</span>
                </a>
              </li>
              <li class="sidebar-dropdown active">
                <a href="#">
                  <i class="bi bi-handbag"></i>
                  <span class="menu-text">Ventas</span>
                </a>
                <div class="sidebar-submenu">
                  <ul>
                    <li>
                      <a href="orders.html">Historial Compras</a>
                    </li>
                    <li>
                      <a href="products.html">Productos</a>
                    </li>
                    <li>
                      <a href="add-product.html" class="current-page">Añadir Productos</a>
                    </li>
                    <li>
                      <a href="add-post.html">Añadir Publicación</a>
                    </li>
                    <li>
                      <a href="add-faq.html">Añadir Pregunta <br> <center>Frecuente</center></a>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="sidebar">
                <a href="calendar-google.html">
                  <i class="bi bi-calendar4"></i>
                  <span class="menu-text">Calendarios</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <!-- Sidebar menu ends -->

      </nav>
      <!-- Sidebar wrapper end -->

      <!-- *************
				************ Main container start *************
			************* -->
      <div class="main-container">

        <!-- Page header starts -->
        <div class="page-header">

          <div class="toggle-sidebar" id="toggle-sidebar"><i class="bi bi-list"></i></div>

          <!-- Breadcrumb start -->
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <i class="bi bi-house"></i>
            </li>
            <li class="breadcrumb-item breadcrumb-active" aria-current="page">Añadir Productos</li>
          </ol>
          <!-- Breadcrumb end -->

          <!-- Header actions ccontainer start -->
          <div class="header-actions-container">

            

            <!-- Header actions start -->
            <ul class="header-actions">

             
              <li class="dropdown">
                <a href="#" id="userSettings" class="user-settings" data-toggle="dropdown" aria-haspopup="true">
                  <span class="user-name d-none d-md-block">Tony Robbins</span>
                  <span class="avatar">
                    <img src="assets/images/user3.png" alt="Free Admin Templates">
                    <span class="status busy"></span>
                  </span>
                </a>
                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="userSettings">
                  <div class="header-profile-actions">
                    <a href="login.html">Cerrar sesión</a>
                  </div>
                </div>
              </li>
            </ul>
            <!-- Header actions end -->

          </div>
          <!-- Header actions ccontainer end -->

        </div>
        <!-- Page header ends -->

        <!-- Content wrapper scroll start -->
        <div class="content-wrapper-scroll">

          <!-- Content wrapper start -->
          <div class="content-wrapper">

            <!-- Formulario de producto -->
            <div class="content-wrapper">
                <div class="row gx-3">
                    <div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Información del producto</div>
                            </div>
                            <div class="card-body">
    
                                <div class="row gx-3">
                                 <div>
                                  <div class="card-border">
                                    <div class="card-border-title">Información general</div>
                                    <div class="card-border-body">
                                      <div class="row gx-3">
                                        <!-- <form id="product-form"> -->
                                            <div class="col-sm-6 col-12">
                                              <div class="mb-3">
                                                <label class="form-label" for="nombre">Nombre:</label>
                                                <input class="form-control" type="text" id="nombre" name="nombre" placeholder="Escriba el nombre del producto aquí">
                                              </div>
                                            </div>
                                            <div class="col-sm-6 col-12">
                                              <div class="mb-3">
                                                <label class="form-label" for="descripcion">Descripción:</label>
                                                <input class="form-control" type="text" id="descripcion" name="descripcion" placeholder="Escriba la descripción del producto aquí">
                                              </div>
                                            </div>

                                            <div class="col-sm-6 col-12">
                                              <div class="mb-3">
                                                <label class="form-label" for="categoria">Categoría:</label>
                                                <select class="form-select" id="categoria" name="categoria">
                                                  <option value="Toallas">Toallas</option>
                                                  <option value="Flujo Abundante">Flujo Abundante</option>
                                                  <option value="Panti">Panti</option>
                                                  <option value="Nocturna">Nocturna</option>
                                                  <!-- Agrega más opciones según sea necesario -->
                                                </select>
                                              </div>
                                            </div>

                                            <div class="col-sm-6 col-12">
                                              <div class="mb-3">
                                                <label class="form-label" for="precio_normal">Precio Normal:</label>
                                                <input class="form-control" type="number" id="precio_normal" name="precio_normal">
                                              </div>
                                            </div>

                                            <div class="col-sm-6 col-12">
                                              <div class="mb-3">
                                                <label class="form-label" for="precio_rebajado">Precio Rebajado:</label>
                                                <input class="form-control" type="number" id="precio_rebajado" name="precio_rebajado">
                                              </div>
                                            </div>

                                            <div class="col-sm-6 col-12">
                                              <div class="mb-3">
                                                <label class="form-label" for="cantidad">Cantidad:</label>
                                                <input class="form-control" type="number" id="cantidad" name="cantidad">
                                              </div>
                                            </div>
                                        <!--</form>-->
                                    </div>
                                  </div>
                                 </div>
                                 </div>

                                 <div id="dropzone" class="dropzone-dark">
                                  <div class="dz-message needsclick">
                                    <form id="image-upload-form" class="dropzone needsclick dz-clickable">
                                      <!-- Aquí va el área de Dropzone -->
                                    </form>
                                  </div>
                                 </div>

                                  <div class="col-sm-12 col-12">
                                    <div class="custom-btn-group flex-end">
                                      <button id="addProductButton" class="btn btn-success">Añadir Producto</button>
                                    </div>
                                  </div>
                                  
                                      <div id="message"></div>
    
                                   
                               
  
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    
        </div>
          <!-- Content wrapper end -->

          

        </div>
        <!-- Content wrapper scroll end -->

      </div>
      <!-- *************
				************ Main container end *************
			************* -->

    </div>
    <!-- Page wrapper end -->

    <!-- *************
			************ Required JavaScript Files *************
		************* -->
    <!-- Required jQuery first, then Bootstrap Bundle JS -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/modernizr.js"></script>
    <script src="assets/js/moment.js"></script>

    <!-- *************
			************ Vendor Js Files *************
		************* -->

    <!-- Overlay Scroll JS -->
    <script src="assets/vendor/overlay-scroll/jquery.overlayScrollbars.min.js"></script>
    <script src="assets/vendor/overlay-scroll/custom-scrollbar.js"></script>

    <!-- Dropzone JS -->
    <script src="assets/vendor/dropzone/dropzone.min.js"></script>

    <!-- Main Js Required -->
    <script src="assets/js/main.js"></script>
    



      <!-- JS de Dropzone y Cloudinary -->
      <script src="https://upload.cloudinary.com/global/all.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"></script>
  
      <!-- Script personalizado -->
      <script>
      // Deshabilitar el descubrimiento automático de Dropzone
      Dropzone.autoDiscover = false;

      const uploadedFiles = [];  // Array para mantener los archivos subidos

      // Inicializar Dropzone
      const myDropzone = new Dropzone("#image-upload-form", {
        url: "#",  // Estamos manejando la carga manualmente
        autoProcessQueue: false,  // Prevenir carga automática
        acceptedFiles: "image/*",  // Solo imágenes permitidas
        init: function() {
          this.on("addedfile", function(file) {
            uploadedFiles.push(file);  // Añadir archivo al array cuando se selecciona
          });
        }
      });

      // Esperar a que el DOM esté completamente cargado
      document.addEventListener('DOMContentLoaded', () => {
        const submitButton = document.getElementById('addProductButton');
        const message = document.getElementById('message');

        if (!submitButton || !message) {
          console.error('Submit button or message element not found!');
          return;
        }

        submitButton.addEventListener('click', async (event) => {
          event.preventDefault();

          if (uploadedFiles.length === 0) {
            alert('Please select an image file first!');
            return;
          }

          message.innerHTML = '';  // Limpiar mensajes previos

          let imageUrl = '';  // Variable para la URL de la imagen

          // Subir la imagen a Cloudinary
          const file = uploadedFiles[0];
          const formData = new FormData();
          formData.append('file', file);
          formData.append('upload_preset', 'xvgd3zza');  // Tu preset de carga en Cloudinary

          try {
            const response = await fetch('https://api.cloudinary.com/v1_1/dasr1gzxt/image/upload', {
              method: 'POST',
              body: formData
            });

            const data = await response.json();
            if (response.ok) {
              imageUrl = data.secure_url;  // Obtener la URL pública de Cloudinary
              message.innerHTML += `<p style="color:green;">Image uploaded successfully!<br>Image URL: <a href="${imageUrl}" target="_blank">${imageUrl}</a></p>`;

              // Crear objeto con los datos del producto
              const nombreElement = document.getElementById('nombre');
              const descripcionElement = document.getElementById('descripcion');
              const categoriaElement = document.getElementById('categoria');
              const precioNormalElement = document.getElementById('precio_normal');
              const precioRebajadoElement = document.getElementById('precio_rebajado');
              const cantidadElement = document.getElementById('cantidad');

              if (!nombreElement || !descripcionElement || !categoriaElement || !precioNormalElement || !precioRebajadoElement || !cantidadElement) {
                console.error('Form elements not found!');
                return;
              }

              const nombre = nombreElement.value || '';
              const descripcion = descripcionElement.value || '';
              const id_categoria = categoriaElement.value;
              const precio_normal = parseFloat(precioNormalElement.value) || 0;
              const precio_rebajado = parseFloat(precioRebajadoElement.value) || 0;
              const cantidad = parseInt(cantidadElement.value, 10) || 0;

              const productData = {
                descripcion: descripcion,
                id_categoria: id_categoria,
                imagen: imageUrl,  // Usar la URL generada para la imagen
                precio_normal: precio_normal,
                cantidad: cantidad,
                nombre: nombre,
                precio_rebajado: precio_rebajado
              };

              // Enviar datos del producto al servidor
              const productResponse = await fetch('https://addproduct-dztx2pd2na-uc.a.run.app', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(productData)  // Convertir objeto a JSON
              });

              const result = await productResponse.json();

              if (!productResponse.ok) {
                throw new Error(result.message || 'Error en el servidor');
              }

              message.innerHTML += `<p style="color:green;">Producto añadido: ${result.message}</p>`;
            } else {
              message.innerHTML += `<p style="color:red;">Error uploading image: ${data.error.message}</p>`;
            }
          } catch (error) {
            console.error('Error:', error);
            message.innerHTML += `<p style="color:red;">Failed to upload image. Error: ${error.message}</p>`;
          }

          // Limpiar el array de archivos subidos después de la carga
          uploadedFiles.length = 0;
        });
      });

</script>

      
      
  </body>

</html>